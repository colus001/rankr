{"version":3,"file":"/Users/endlessdev/Workspace/rankr-org/utils/CommonParser.ts","sources":["/Users/endlessdev/Workspace/rankr-org/utils/CommonParser.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAGA,gDAAyD;AAGzD,IAAM,OAAO,GAAG,OAAO,CAAC,iBAAiB,CAAC,EACtC,OAAO,GAAG,OAAO,CAAC,SAAS,CAAC,CAAC;AAOjC;IAAA;IAgDA,CAAC;IA3CU,+BAAQ,GAAf,UAAgB,WAAwB;QACpC,IAAI,CAAC,WAAW,GAAG,WAAW,CAAC;IACnC,CAAC;IAEY,8BAAO,GAApB;;;;;;;wBAEyB,WAAM,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,EAAA;;mCAAvC,SAAuC;wBACxD,WAAO,IAAI,CAAC,cAAc,CAAC,QAAQ,CAAC,EAAC;;;wBAErC,WAAO,KAAG,EAAC;;;;;KAElB;IAEO,qCAAc,GAAtB,UAAuB,IAAY;QAC/B,IAAI,CAAC,GAAQ,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAEhC,IAAI,CAAC,UAAU,GAAG;YACd,UAAU,EAAE,GAAG;YACf,QAAQ,EAAE,IAAI,CAAC,WAAW,CAAC,IAAI;YAC/B,WAAW,EAAE,IAAI,IAAI,EAAE;YACvB,IAAI,EAAE,EAAE;SACX,CAAC;QAEF,IAAI,IAAI,GAAG,IAAI,CAAC;QAChB,IAAI,CAAC,UAAU,CAAC,IAAI,GAAG,EAAE,CAAC;QAE1B,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,aAAa,CAAC,CAAC,IAAI,CAAC,UAAC,CAAS,EAAE,IAAS;YACxD,IAAI,UAAU,GAAG,IAAI,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC;YAC1D,IAAI,QAAQ,GAAS;gBACjB,IAAI,EAAE,CAAC,GAAG,CAAC;gBACX,KAAK,EAAE,UAAU,CAAC,KAAK;gBACvB,KAAK,EAAE,UAAU,CAAC,KAAK;aAC1B,CAAC;YACF,EAAE,CAAC,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC,CAAC;gBACpB,QAAQ,CAAC,MAAM,GAAe,iCAAqB,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC;YAC3E,CAAC;YACD,EAAE,CAAC,CAAC,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC;gBAClB,OAAO,QAAQ,CAAC,KAAK,CAAC;YAC1B,CAAC;YACD,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QACxC,CAAC,CAAC,CAAC;QACH,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC;IAC3B,CAAC;IACL,mBAAC;AAAD,CAAC,AAhDD,IAgDC","sourcesContent":["import {ParserParam} from \"../models/ParserParam\";\nimport {RankResult} from \"../models/RankResult\";\nimport {Rank} from \"../models/Rank\";\nimport {changeFormattedStatus} from \"../utils/Formatter\";\nimport {RankStatus} from \"../models/RankStatus\";\n\nconst request = require('request-promise'),\n    cheerio = require('cheerio');\n\n/**\n * Created by jade on 29/04/2017.\n */\n\n\nexport default class CommonParser {\n\n    private parserParam: ParserParam;\n    private rankResult: RankResult;\n\n    public setParam(parserParam: ParserParam) {\n        this.parserParam = parserParam;\n    }\n\n    public async getRank() {\n        try {\n            const response = await request.get(this.parserParam.url);\n            return this.handleRankData(response);\n        } catch (err) {\n            return err;\n        }\n    }\n\n    private handleRankData(html: string) {\n        let $: any = cheerio.load(html);\n\n        this.rankResult = {\n            resultCode: 200,\n            rankType: this.parserParam.type,\n            requestDate: new Date(),\n            data: []\n        };\n\n        let self = this;\n        self.rankResult.data = [];\n\n        $(this.parserParam.querySelector).each((i: number, elem: any) => {\n            let resultData = self.parserParam.parserSelector($, elem);\n            let rankData: Rank = {\n                rank: i + 1,\n                value: resultData.value,\n                title: resultData.title,\n            };\n            if (resultData.status) {\n                rankData.status = <RankStatus>changeFormattedStatus(resultData.status);\n            }\n            if (!rankData.value) {\n                delete rankData.value;\n            }\n            self.rankResult.data.push(rankData);\n        });\n        return this.rankResult;\n    }\n}"]}